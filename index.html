<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç­çº§è¹­é¥­åœ°å›¾</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <!-- Tailwindé…ç½® -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#7e57c2',
            secondary: '#f5f5f7',
            neutral: {
              50: '#f5f5f7',
              100: '#e9e9eb',
              200: '#d2d2d7',
              300: '#b7b7bb',
              400: '#86868b',
              500: '#6e6e73',
              600: '#58585b',
              700: '#3a3a3c',
              800: '#2c2c2e',
              900: '#1c1c1e',
            }
          },
          fontFamily: {
            inter: ['SF Pro Text', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>

  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .province {
        transition: all 0.3s ease;
        cursor: pointer;
      }
      .province:hover {
        fill: rgba(79, 70, 229, 0.2);
        stroke: #4F46E5;
        stroke-width: 1.5px;
      }
      .card-hover {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }
      .card-hover:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px -5px rgba(126, 87, 194, 0.2);
      }
    }
  </style>
</head>
<body class="font-inter bg-neutral-100 text-neutral-800 min-h-screen flex flex-col text-xl">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <header class="bg-white shadow-sm sticky top-0 z-50">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
      <div class="flex items-center space-x-3">
        <i class="fa fa-map-marker text-primary text-2xl"></i>
        <h1 class="text-2xl font-bold">ç­çº§è¹­é¥­åœ°å›¾</h1>
      </div>
      <div class="flex items-center space-x-4">
        <button id="mobileUploadBtn" class="md:hidden text-neutral-700 hover:text-primary">
          <i class="fa fa-upload text-xl"></i>
        </button>
      </div>
    </div>
  </header>

  <!-- ä¸»è¦å†…å®¹åŒº -->
  <main class="flex-grow container mx-auto px-4 py-6">
    <!-- ä¸Šä¼ æç¤ºå¡ç‰‡ -->
    <div id="uploadPrompt" class="bg-white rounded-xl shadow-sm p-6 mb-6 text-center">
      <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4">
        <i class="fa fa-file-excel-o text-primary text-2xl"></i>
      </div>
      <h2 class="text-2xl font-semibold mb-2">ä¸Šä¼ åŒå­¦æ•°æ®</h2>
      <p class="text-neutral-600 mb-6 max-w-md mx-auto">
        è¯·ä¸Šä¼ åŒ…å«åŒå­¦ä¿¡æ¯çš„Excelæ–‡ä»¶ï¼ˆeatmap.xlsxï¼‰ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨è§£æå¹¶åœ¨åœ°å›¾ä¸Šæ˜¾ç¤ºåŒå­¦åˆ†å¸ƒ
      </p>
      <label for="mobileFileUpload" class="inline-flex items-center bg-primary text-white px-4 py-2 rounded-lg cursor-pointer transition-colors hover:bg-primary/90">
        <i class="fa fa-upload mr-2"></i>é€‰æ‹©Excelæ–‡ä»¶
        <input type="file" id="mobileFileUpload" accept=".xlsx,.xls" class="hidden">
      </label>
    </div>

    <!-- æ•°æ®ç»Ÿè®¡å¡ç‰‡ -->
    <div id="statsCards" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 hidden">
      <div class="bg-white rounded-xl shadow-sm p-5 card-hover">
        <div class="flex items-center justify-between mb-2">
          <h3 class="text-neutral-600 font-medium">æ€»äººæ•°</h3>
          <i class="fa fa-users text-primary text-xl"></i>
        </div>
        <p id="totalStudents" class="text-3xl font-bold">0</p>
      </div>
      <div class="bg-white rounded-xl shadow-sm p-5 card-hover">
        <div class="flex items-center justify-between mb-2">
          <h3 class="text-neutral-600 font-medium">è¦†ç›–çœä»½</h3>
          <i class="fa fa-map text-secondary text-xl"></i>
        </div>
        <p id="totalProvinces" class="text-3xl font-bold">0</p>
      </div>
      <div class="bg-white rounded-xl shadow-sm p-5 card-hover">
        <div class="flex items-center justify-between mb-2">
          <h3 class="text-neutral-600 font-medium">å¹³å‡åˆ†å¸ƒ</h3>
          <i class="fa fa-bar-chart text-green-500 text-xl"></i>
        </div>
        <p id="avgDistribution" class="text-3xl font-bold">0</p>
      </div>
    </div>

    <!-- åœ°å›¾å®¹å™¨ -->
    <div id="mapContainer" class="bg-white rounded-xl shadow-sm p-4 md:p-6 hidden">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-semibold">åŒå­¦åˆ†å¸ƒåœ°å›¾</h2>
        <div class="flex space-x-2">
          <button id="zoomIn" class="p-2 rounded-full hover:bg-neutral-200 transition-colors">
            <i class="fa fa-search-plus text-neutral-700"></i>
          </button>
          <button id="zoomOut" class="p-2 rounded-full hover:bg-neutral-200 transition-colors">
            <i class="fa fa-search-minus text-neutral-700"></i>
          </button>
          <button id="resetMap" class="p-2 rounded-full hover:bg-neutral-200 transition-colors">
            <i class="fa fa-refresh text-neutral-700"></i>
          </button>
        </div>
      </div>

      <!-- åœ°å›¾å°†åœ¨è¿™é‡Œæ¸²æŸ“ -->
      <div class="w-full h-[60vh] relative border border-neutral-200 rounded-lg overflow-hidden">
        <svg id="chinaMap" class="w-full h-full"></svg>

        <!-- åŠ è½½æŒ‡ç¤ºå™¨ -->
        <div id="mapLoader" class="absolute inset-0 bg-white/80 flex items-center justify-center z-10">
          <div class="text-center">
            <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary mb-4"></div>
            <p class="text-neutral-700">åŠ è½½åœ°å›¾ä¸­...</p>
          </div>
        </div>

        <!-- æ‚¬åœæç¤ºæ¡† -->
        <div id="tooltip" class="absolute bg-white rounded-lg shadow-lg p-3 z-20 hidden pointer-events-none max-w-[200px] border border-neutral-200">
          <h3 class="font-semibold text-neutral-800 mb-1" id="tooltipTitle"></h3>
          <ul id="tooltipContent" class="text-base text-neutral-600 space-y-1"></ul>
        </div>
      </div>
    </div>
  </main>

  <!-- è¯¦æƒ…æ¨¡æ€æ¡† -->
  <div id="detailModal" class="fixed inset-0 bg-black/50 z-50 hidden items-center justify-center p-4">
    <div class="bg-white rounded-xl shadow-xl w-full max-w-2xl max-h-[85vh] overflow-y-auto">
      <div class="p-5 border-b flex justify-between items-center sticky top-0 bg-white z-10">
        <h2 class="text-xl font-bold" id="modalTitle"></h2>
        <button id="closeModal" class="text-neutral-400 hover:text-neutral-700">
          <i class="fa fa-times text-xl"></i>
        </button>
      </div>
      <div class="p-5">
        <p class="text-neutral-600 mb-5">è¯¥åœ°åŒºå…±æœ‰ <span id="modalStudentCount" class="font-semibold text-primary">0</span> ä½åŒå­¦</p>

        <div id="studentGrid" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <!-- åŒå­¦ä¿¡æ¯å¡ç‰‡å°†åŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
        </div>
      </div>
    </div>
  </div>

  <!-- é¡µè„š -->
  <footer class="bg-neutral-800 text-white py-6 mt-8">
    <div class="container mx-auto px-4 text-center text-neutral-300 text-sm">
      <p>å‡¡å¿ƒæ‰€å‘ï¼Œç´ å±¥å…¶å¾€ï¼Œå…­äº”å…«ç­ï¼Œä¸€è‹‡ä»¥èˆª</p>
    </div>
  </footer>

  <script>
    // å…¨å±€å˜é‡
    let svg, projection, path, studentsData = {};
    let mapData = null;
    let currentScale = 1;
    let currentTranslate = [0, 0];

    // DOMå…ƒç´ 
    const fileUpload = document.getElementById('fileUpload');
    const mobileFileUpload = document.getElementById('mobileFileUpload');
    const mobileUploadBtn = document.getElementById('mobileUploadBtn');
    const uploadPrompt = document.getElementById('uploadPrompt');
    const statsCards = document.getElementById('statsCards');
    const mapContainer = document.getElementById('mapContainer');
    const mapLoader = document.getElementById('mapLoader');
    const tooltip = document.getElementById('tooltip');
    const tooltipTitle = document.getElementById('tooltipTitle');
    const tooltipContent = document.getElementById('tooltipContent');
    const detailModal = document.getElementById('detailModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalStudentCount = document.getElementById('modalStudentCount');
    const studentGrid = document.getElementById('studentGrid');
    const closeModal = document.getElementById('closeModal');
    const totalStudentsEl = document.getElementById('totalStudents');
    const totalProvincesEl = document.getElementById('totalProvinces');
    const avgDistributionEl = document.getElementById('avgDistribution');
    const zoomInBtn = document.getElementById('zoomIn');
    const zoomOutBtn = document.getElementById('zoomOut');
    const resetMapBtn = document.getElementById('resetMap');

    // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
    function initEventListeners() {
      // æ¨¡æ€æ¡†å…³é—­äº‹ä»¶
      closeModal.addEventListener('click', () => {
        detailModal.classList.remove('flex');
        detailModal.classList.add('hidden');
      });

      detailModal.addEventListener('click', (e) => {
        if (e.target === detailModal) {
          detailModal.classList.remove('flex');
          detailModal.classList.add('hidden');
        }
      });

      // åœ°å›¾æ§åˆ¶äº‹ä»¶
      zoomInBtn.addEventListener('click', () => {
        currentScale = Math.min(currentScale * 1.2, 3);
        updateMapTransform();
      });

      zoomOutBtn.addEventListener('click', () => {
        currentScale = Math.max(currentScale / 1.2, 0.5);
        updateMapTransform();
      });

      resetMapBtn.addEventListener('click', () => {
        currentScale = 1;
        currentTranslate = [0, 0];
        updateMapTransform();
      });

      // çª—å£å¤§å°å˜åŒ–æ—¶é‡ç»˜åœ°å›¾
      window.addEventListener('resize', () => {
        if (mapData) {
          renderMap();
        }
      });
    }

    // å¤„ç†Excelæ–‡ä»¶ä¸Šä¼ 
    function handleFileUpload(e) {
      const file = e.target.files[0];
      if (!file) return;

      // éªŒè¯æ–‡ä»¶ç±»å‹
      if (!file.name.endsWith('.xlsx') && !file.name.endsWith('.xls')) {
        alert('è¯·ä¸Šä¼ Excelæ–‡ä»¶(.xlsxæˆ–.xlsæ ¼å¼)');
        return;
      }

      // è¯»å–Excelæ–‡ä»¶
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = new Uint8Array(e.target.result);
          const workbook = XLSX.read(data, { type: 'array' });
          const firstSheetName = workbook.SheetNames[0];
          const worksheet = workbook.Sheets[firstSheetName];
          const jsonData = XLSX.utils.sheet_to_json(worksheet);

          // å¤„ç†Excelæ•°æ®
          processExcelData(jsonData);

          // æ˜¾ç¤ºåœ°å›¾å’Œç»Ÿè®¡ä¿¡æ¯
          uploadPrompt.classList.add('hidden');
          statsCards.classList.remove('hidden');
          mapContainer.classList.remove('hidden');

          // å¦‚æœåœ°å›¾æ•°æ®å°šæœªåŠ è½½ï¼Œåˆ™åŠ è½½åœ°å›¾
          if (!mapData) {
            loadMapData();
          } else {
            // å¦åˆ™é‡æ–°æ¸²æŸ“åœ°å›¾
            renderMap();
          }
        } catch (error) {
          console.error('è§£æExcelæ–‡ä»¶å¤±è´¥:', error);
          alert('è§£æExcelæ–‡ä»¶å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®');
        }
      };
      reader.readAsArrayBuffer(file);
    }

    // å¤„ç†Excelæ•°æ®
    function processExcelData(jsonData) {
      // å‡è®¾ExcelåŒ…å«"å§“å"ã€"çœä»½"ã€"åŸå¸‚"ã€"å­¦æ ¡"ã€"ä¸“ä¸š"ç­‰åˆ—
      const processedData = {};

      jsonData.forEach(student => {
        const province = student.çœä»½ || student.province || 'æœªçŸ¥çœä»½';
        if (!processedData[province]) {
          processedData[province] = [];
        }

        // æ ‡å‡†åŒ–å­¦ç”Ÿæ•°æ®
        processedData[province].push({
          name: student.å§“å || student.name || 'æœªçŸ¥å§“å',
          city: student.åŸå¸‚ || student.city || '',
          school: student.å­¦æ ¡ || student.school || '',
          phone: student.ç”µè¯ || student.phone || '',
        });
      });

      studentsData = processedData;

      // æ›´æ–°ç»Ÿè®¡æ•°æ®
      updateStats();
    }

    // æ›´æ–°ç»Ÿè®¡æ•°æ®
    function updateStats() {
      const totalStudents = Object.values(studentsData)
        .reduce((sum, students) => sum + students.length, 0);
      const totalProvinces = Object.keys(studentsData).length;
      const avgDistribution = totalProvinces > 0
        ? (totalStudents / totalProvinces).toFixed(1)
        : '0';

      totalStudentsEl.textContent = totalStudents;
      totalProvincesEl.textContent = totalProvinces;
      avgDistributionEl.textContent = avgDistribution;
    }

    // åŠ è½½åœ°å›¾æ•°æ®
    async function loadMapData() {
      try {
        // ä¼˜å…ˆä½¿ç”¨æœ¬åœ°GeoJSONæ–‡ä»¶ï¼Œå¦‚æœå¤±è´¥åˆ™å°è¯•åœ¨çº¿API
        try {
          mapData = await d3.json('chinamap.geojson');
        } catch (localError) {
          console.warn('åŠ è½½æœ¬åœ°åœ°å›¾æ•°æ®å¤±è´¥ï¼Œå°è¯•åœ¨çº¿API:', localError);
          mapData = await d3.json('https://geo.datav.aliyun.com/areas_v3/bound/geojson?code=100000_full');
        }
        renderMap();
      } catch (error) {
        console.error('åŠ è½½åœ°å›¾æ•°æ®å¤±è´¥:', error);
        mapLoader.innerHTML = `
          <div class="text-center">
            <i class="fa fa-exclamation-triangle text-red-500 text-2xl mb-4"></i>
            <p class="text-neutral-700">åŠ è½½åœ°å›¾å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•</p>
          </div>
        `;
      }
    }

    // æ¸²æŸ“åœ°å›¾
    function renderMap() {
      // æ¸…é™¤ç°æœ‰åœ°å›¾
      d3.select('#chinaMap').selectAll('*').remove();

      // è·å–å®¹å™¨å°ºå¯¸
      const container = document.getElementById('chinaMap').parentElement;
      const width = container.clientWidth;
      const height = container.clientHeight;

      // åˆ›å»ºSVG
      svg = d3.select('#chinaMap')
        .attr('width', width)
        .attr('height', height);

      // åˆ›å»ºæŠ•å½±
      projection = d3.geoMercator()
        .center([105, 35]) // ä¸­å›½ä¸­å¿ƒåæ ‡
        .scale(width / 2.5) // ç¼©æ”¾æ¯”ä¾‹ (è¿›ä¸€æ­¥æ”¾å¤§)
        .translate([width / 2, height / 2]); // å¹³ç§»åˆ°å®¹å™¨ä¸­å¿ƒ

      // åˆ›å»ºè·¯å¾„ç”Ÿæˆå™¨
      path = d3.geoPath().projection(projection);

      // æ·»åŠ åœ°å›¾è·¯å¾„
      const provinces = svg.selectAll('path')
        .data(mapData.features)
        .enter()
        .append('path')
        .attr('d', path)
        .attr('class', 'province')
        .attr('fill', d => {
          const provinceName = d.properties.name;
          return studentsData[provinceName] && studentsData[provinceName].length > 0
            ? '#EDE9FE' // æœ‰åŒå­¦çš„çœä»½
            : '#F3F4F6'; // æ²¡æœ‰åŒå­¦çš„çœä»½
        })
        .attr('stroke', '#D1D5DB')
        .attr('stroke-width', 1)
        .attr('data-name', d => d.properties.name);

      // æ·»åŠ çœä»½åç§°æ ‡ç­¾
      svg.selectAll('text')
        .data(mapData.features)
        .enter()
        .append('text')
        .attr('transform', d => {
          const centroid = path.centroid(d);
          return `translate(${centroid[0]}, ${centroid[1]})`;
        })
        .attr('text-anchor', 'middle')
        .attr('dominant-baseline', 'middle')
        .attr('font-size', '12px')
        .attr('fill', '#6B7280')
        .text(d => {
          const name = d.properties.name;
          // ç®€åŒ–é•¿çœä»½åç§°
          if (name.length > 3) {
            return name.substring(0, 2);
          }
          return name;
        })
        .attr('pointer-events', 'none');

      // æ·»åŠ äº¤äº’äº‹ä»¶
      provinces
        .on('mouseover', handleMouseOver)
        .on('mousemove', handleMouseMove)
        .on('mouseout', handleMouseOut)
        .on('click', handleProvinceClick);

      // æ·»åŠ åœ°å›¾ç¼©æ”¾å’Œå¹³ç§»
      svg.call(d3.zoom()
        .scaleExtent([0.5, 3])
        .on('zoom', (event) => {
          currentScale = event.transform.k;
          currentTranslate = [event.transform.x, event.transform.y];
          svg.selectAll('path').attr('transform', event.transform);
          svg.selectAll('text').attr('transform', d => {
            const centroid = path.centroid(d);
            const [x, y] = event.transform.apply([centroid[0], centroid[1]]);
            return `translate(${x}, ${y})`;
          });
        }));

      // éšè—åŠ è½½æŒ‡ç¤ºå™¨
      mapLoader.classList.add('hidden');
    }

    // æ›´æ–°åœ°å›¾å˜æ¢
    function updateMapTransform() {
      svg.transition()
        .duration(300)
        .call(d3.zoom().transform, d3.zoomIdentity
          .translate(currentTranslate[0], currentTranslate[1])
          .scale(currentScale)
        );
    }

    // å¤„ç†é¼ æ ‡æ‚¬åœäº‹ä»¶
    function handleMouseOver(event, d) {
      const provinceName = d.properties.name;
      const students = studentsData[provinceName] || [];

      tooltipTitle.textContent = provinceName;
      tooltipContent.innerHTML = '';

      if (students.length > 0) {
        students.slice(0, 3).forEach(student => {
          const li = document.createElement('li');
          li.className = 'flex items-center';
          li.innerHTML = `
            <i class="fa fa-user text-primary mr-2"></i>
            <span>${student.name}${student.school ? `(${student.school})` : ''}</span>
          `;
          tooltipContent.appendChild(li);
        });

        if (students.length > 3) {
          const li = document.createElement('li');
          li.className = 'text-neutral-400 text-center mt-1';
          li.textContent = `+${students.length - 3}ä½åŒå­¦`;
          tooltipContent.appendChild(li);
        }
      } else {
        tooltipContent.innerHTML = '<li class="text-neutral-400"><i class="fa fa-meh-o mr-2"></i>æš‚æ— åŒå­¦</li>';
      }

      tooltip.classList.remove('hidden');
      handleMouseMove(event);
    }

    // å¤„ç†é¼ æ ‡ç§»åŠ¨äº‹ä»¶
    function handleMouseMove(event) {
      const tooltipWidth = tooltip.offsetWidth;
      const tooltipHeight = tooltip.offsetHeight;
      const container = tooltip.parentElement;
      const containerRect = container.getBoundingClientRect();

      // è®¡ç®—tooltipä½ç½®
      let left = event.clientX - containerRect.left + 10;
      let top = event.clientY - containerRect.top + 10;

      // ç¡®ä¿tooltipä¸ä¼šè¶…å‡ºå®¹å™¨
      if (left + tooltipWidth > containerRect.width) {
        left = event.clientX - containerRect.left - tooltipWidth - 10;
      }

      if (top + tooltipHeight > containerRect.height) {
        top = event.clientY - containerRect.top - tooltipHeight - 10;
      }

      tooltip.style.left = `${left}px`;
      tooltip.style.top = `${top}px`;
    }

    // å¤„ç†é¼ æ ‡ç§»å‡ºäº‹ä»¶
    function handleMouseOut() {
      tooltip.classList.add('hidden');
    }

    // å¤„ç†çœä»½ç‚¹å‡»äº‹ä»¶
    function handleProvinceClick(event, d) {
      const provinceName = d.properties.name;
      const students = studentsData[provinceName] || [];

      modalTitle.textContent = provinceName;
      modalStudentCount.textContent = students.length;
      studentGrid.innerHTML = '';

      if (students.length > 0) {
        students.forEach(student => {
          const card = document.createElement('div');
          card.className = 'bg-white rounded-lg p-4 border border-neutral-200 transition-all duration-300 hover:shadow-md hover:border-primary';
          card.innerHTML = `
            <h3 class="font-semibold text-neutral-800 text-lg">${student.name}</h3>
            ${student.school ? `<p class="text-base text-neutral-600 mb-2">${student.school} </p>` : ''}
            ${student.city ? `<p class="text-base text-neutral-500 mb-3"><i class="fa fa-map-marker text-primary mr-1"></i>${student.city}</p>` : ''}
            <div class="grid grid-cols-2 gap-2 text-base">
              ${student.phone ? `<div class="flex items-center text-neutral-600"><i class="fa fa-phone text-primary mr-1 w-4"></i>${student.phone}</div>` : ''}
            </div>
          `;
          studentGrid.appendChild(card);
        });
      } else {
        studentGrid.innerHTML = `
          <div class="col-span-2 py-12 text-center text-neutral-400">
            <i class="fa fa-frown-o text-4xl mb-2"></i>
            <p>è¯¥çœä»½æš‚æ— åŒå­¦æ•°æ®</p>
          </div>
        `;
      }

      // æ˜¾ç¤ºæ¨¡æ€æ¡†
      detailModal.classList.remove('hidden');
      detailModal.classList.add('flex');
    }

   
    // æ·»åŠ ä¸€äº›CSSåŠ¨ç”»å’Œè¿‡æ¸¡æ•ˆæœ
    const style = document.createElement('style');
    style.textContent = `
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .stat-card {
        transition: all 0.3s ease;
      }
      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      }
      .modal-content {
        animation: fadeIn 0.3s ease;
        background-color: white;
        border-radius: 12px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        border: 1px solid #e9e9eb;
      }
      path.province {
        transition: fill 0.3s ease, stroke 0.3s ease;
      }
      path.province:hover {
        stroke-width: 2px;
        stroke: #7e57c2;
        fill-opacity: 0.8;
      }
    `;
    document.head.appendChild(style);

    // ç¾åŒ–é¡µé¢æ ‡é¢˜
    document.title = 'è¹­é¥­ğŸšğŸ¨ğŸ';

    // æ”¹è¿›é¡µé¢å¤´éƒ¨æ ·å¼
    const header = document.createElement('header');
    header.className = 'bg-gradient-to-r from-purple-400 to-blue-500 py-6 px-4';
    header.innerHTML = `
      <div class='container mx-auto'>
          <h1 class='text-2xl md:text-3xl font-bold text-white'>åº·å’Œäº”å…«è¹­é¥­åœ°å›¾</h1>
          <p class='text-white/80'>åº·å¸…:â€œæˆ‘ä¸€è§ä½ å°±ç¬‘ï¼Œä½ é‚£è¿·äººçš„é£é‡‡å¤ªç¾å¦™â€</p>
        </div>
    `;
    document.body.insertBefore(header, document.body.firstChild);

    // æ·»åŠ é¡µè„š
    const footer = document.createElement('footer');
    footer.className = 'bg-gradient-to-r from-purple-400 to-blue-500 text-white py-4 px-4 mt-8';
    footer.innerHTML = `
      <div class='container mx-auto text-center text-base'>
        <p>658è¹­é¥­åœ°å›¾ &copy; ${new Date().getFullYear()} | æ°¸è¿œçš„Kæ´¾</p>
      </div>
    `;
    document.body.appendChild(footer);

    // ç¾åŒ–ç»Ÿè®¡å¡ç‰‡
    const statsContainer = document.querySelector('.stats-container');
    if (statsContainer) {
      statsContainer.className = 'grid grid-cols-1 md:grid-cols-3 gap-4 mt-6';
      const statCards = statsContainer.querySelectorAll('.stat-card');
      statCards.forEach(card => {
        card.className = 'bg-white rounded-lg p-4 border border-neutral-200 stat-card transition-all duration-300 hover:shadow-md';
      });
    }

    // ç¾åŒ–åœ°å›¾å®¹å™¨
    const mapContainerç¾åŒ– = document.getElementById('map-container');
    if (mapContainerç¾åŒ–) {
      mapContainerç¾åŒ–.className = 'bg-neutral-50 rounded-lg p-4 mt-6 border border-neutral-200';
    }

    // æ‰‹åŠ¨å½•å…¥åŒå­¦æ•°æ®
    function manuallyEnterData() {
      // åœ¨è¿™é‡Œæ‰‹åŠ¨å½•å…¥åŒå­¦æ•°æ®
      // æ ¼å¼: { 'å§“å': 'å¼ ä¸‰', 'çœä»½': 'åŒ—äº¬å¸‚', 'åŸå¸‚': 'åŒ—äº¬å¸‚', 'å­¦æ ¡': 'åŒ—äº¬å¤§å­¦', 'ä¸“ä¸š': 'è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯', 'ç”µè¯': '13800138000', 'å¾®ä¿¡': 'zhangsan123' }
      return [
        { 'å§“å': 'ä¹”æŒ¯æ´‹', 'çœä»½': 'æ¹–å—çœ', 'åŸå¸‚': 'é•¿æ²™å¸‚', 'å­¦æ ¡': 'å›½é˜²ç§‘æŠ€å¤§å­¦å¤§å­¦', 'ç”µè¯': '15149721081'},
        { 'å§“å': 'æ®µç¦å¤©', 'çœä»½': 'å››å·çœ', 'åŸå¸‚': 'æˆéƒ½å¸‚', 'å­¦æ ¡': 'ç”µå­ç§‘æŠ€å¤§å­¦','ç”µè¯': '16647776356'},
        { 'å§“å': 'æ¨å­ç‘„', 'çœä»½': 'é»‘é¾™æ±Ÿçœ', 'åŸå¸‚': 'å“ˆå°”æ»¨å¸‚', 'å­¦æ ¡': 'å“ˆå°”æ»¨å·¥ä¸šå¤§å­¦','ç”µè¯': '18847709909'},
        { 'å§“å': 'ç§¦å®¶ç›', 'çœä»½': 'è¾½å®çœ', 'åŸå¸‚': 'å¤§è¿å¸‚', 'å­¦æ ¡': 'å¤§è¿åŒ»ç§‘å¤§å­¦', 'ç”µè¯': '13722191213'},
        { 'å§“å': 'é™ˆå…ƒç§‘', 'çœä»½': 'é‡åº†å¸‚', 'åŸå¸‚': 'é‡åº†å¸‚', 'å­¦æ ¡': 'é‡åº†å¤§å­¦', 'ç”µè¯': '15598702336'},
        { 'å§“å': 'æ¨Šå²©æ¾', 'çœä»½': 'åŒ—äº¬å¸‚', 'åŸå¸‚': 'åŒ—äº¬å¸‚', 'å­¦æ ¡': 'åŒ—äº¬ç§‘æŠ€å¤§å­¦', 'ç”µè¯': '13204845651'},
        { 'å§“å': 'èµµæ™¨ç‘œ', 'çœä»½': 'æ±Ÿè‹çœ', 'åŸå¸‚': 'å¾å·å¸‚', 'å­¦æ ¡': 'ä¸­å›½çŸ¿ä¸šå¤§å­¦', 'ç”µè¯': '17747197308'},
        { 'å§“å': 'é’±æ”¿å…ˆ', 'çœä»½': 'æ¹–å—çœ', 'åŸå¸‚': 'é•¿æ²™å¸‚', 'å­¦æ ¡': 'ä¸­å—å¤§å­¦', 'ç”µè¯': '18347727447'},
        { 'å§“å': 'ç‹äº‘ç¿”', 'çœä»½': 'åŒ—äº¬å¸‚', 'åŸå¸‚': 'åŒ—äº¬å¸‚', 'å­¦æ ¡': 'åŒ—äº¬äº¤é€šå¤§å­¦', 'ç”µè¯': '18647271072'},
        { 'å§“å': 'ç™½æŠ’é€¸', 'çœä»½': 'å››å·çœ', 'åŸå¸‚': 'æˆéƒ½å¸‚', 'å­¦æ ¡': 'å››å·å¤§å­¦', 'ç”µè¯': '15248432958'},
        { 'å§“å': 'ä¾¯å«è½©', 'çœä»½': 'é‡åº†å¸‚', 'åŸå¸‚': 'é‡åº†å¸‚', 'å­¦æ ¡': 'é‡åº†å¤§å­¦', 'ç”µè¯': '15248432958'},
        { 'å§“å': 'åˆ˜æ²›éœ–', 'çœä»½': 'æ±Ÿè‹çœ', 'åŸå¸‚': 'å¾å·å¸‚', 'å­¦æ ¡': 'ä¸­å›½çŸ¿ä¸šå¤§å­¦',  'ç”µè¯': '15048739996'},
        { 'å§“å': 'ç™½é›¨æ…§', 'çœä»½': 'æ¹–å—çœ', 'åŸå¸‚': 'é•¿æ²™å¸‚', 'å­¦æ ¡': 'ä¸­å—å¤§å­¦', 'ç”µè¯': '15391260430'},
        { 'å§“å': 'ç‹ç›å¦', 'çœä»½': 'æ²³åŒ—çœ', 'åŸå¸‚': 'ä¿å®šå¸‚', 'å­¦æ ¡': 'ååŒ—ç”µåŠ›å¤§å­¦', 'ç”µè¯': '13314777683'},
        { 'å§“å': 'é©¬ç†™éš†', 'çœä»½': 'æ²³åŒ—çœ', 'åŸå¸‚': 'ä¿å®šå¸‚', 'å­¦æ ¡': 'ååŒ—ç”µåŠ›å¤§å­¦', 'ç”µè¯': '13847721191'},
        { 'å§“å': 'èµµç¦¹ç†™', 'çœä»½': 'å››å·çœ', 'åŸå¸‚': 'æˆéƒ½å¸‚', 'å­¦æ ¡': 'å››å·å¤§å­¦', 'ç”µè¯': '13847712575'},
        { 'å§“å': 'ææ˜Šç¦¹', 'çœä»½': 'æ±Ÿè‹çœ', 'åŸå¸‚': 'å¾å·å¸‚', 'å­¦æ ¡': 'ä¸­å›½çŸ¿ä¸šå¤§å­¦', 'ç”µè¯': '18604772974'},
        { 'å§“å': 'å´”æµ©ç„¶', 'çœä»½': 'åŒ—äº¬å¸‚', 'åŸå¸‚': 'åŒ—äº¬å¸‚', 'å­¦æ ¡': 'ä¸­å¤®è´¢ç»å¤§å­¦', 'ç”µè¯': '15704907423'},
        { 'å§“å': 'ç‹æ€¡å®', 'çœä»½': 'å››å·çœ', 'åŸå¸‚': 'æˆéƒ½å¸‚', 'å­¦æ ¡': 'ä¸­å—å¤§å­¦(é•¿æ²™)', 'ç”µè¯': '15384778230'},
        { 'å§“å': 'é«˜æ¥šåš', 'çœä»½': 'å››å·çœ', 'åŸå¸‚': 'æˆéƒ½å¸‚', 'å­¦æ ¡': 'ä¸­å—å¤§å­¦(é•¿æ²™)', 'ç”µè¯': '18147711888'},
        { 'å§“å': 'ç±³ç¥å…´', 'çœä»½': 'é™•è¥¿çœ', 'åŸå¸‚': 'è¥¿å®‰å¸‚', 'å­¦æ ¡': 'è¥¿å®‰äº¤é€šå¤§å­¦', 'ç”µè¯': '15047353552'},
        { 'å§“å': 'å€ªèˆ’æº', 'çœä»½': 'åŒ—äº¬å¸‚', 'åŸå¸‚': 'åŒ—äº¬å¸‚', 'å­¦æ ¡': 'åŒ—äº¬ç§‘æŠ€å¤§å­¦', 'ç”µè¯': '18347769619'},
        { 'å§“å': 'è¨¾å“ç„¶', 'çœä»½': 'è¾½å®çœ', 'åŸå¸‚': 'å¤§è¿å¸‚', 'å­¦æ ¡': 'å¤§è¿ç†å·¥å¤§å­¦', 'ç”µè¯': '18700283373'},
        { 'å§“å': 'ä»»å€¢', 'çœä»½': 'åŒ—äº¬å¸‚', 'åŸå¸‚': 'åŒ—äº¬å¸‚', 'å­¦æ ¡': 'åŒ—äº¬ç§‘æŠ€å¤§å­¦', 'ç”µè¯': '15661864696'},
        { 'å§“å': 'é™ˆé›¨æ¶µ', 'çœä»½': 'æ¹–åŒ—çœ', 'åŸå¸‚': 'æ­¦æ±‰å¸‚', 'å­¦æ ¡': 'åä¸­å¸ˆèŒƒå¤§å­¦', 'ç”µè¯': '15044924646'},
        { 'å§“å': 'ç”°è‚²æ—', 'çœä»½': 'åŒ—äº¬å¸‚', 'åŸå¸‚': 'åŒ—äº¬å¸‚', 'å­¦æ ¡': 'åŒ—äº¬äº¤é€šå¤§å­¦', 'ç”µè¯': '18004770556'},
        { 'å§“å': 'æ­¦å­å¢¨', 'çœä»½': 'ä¸Šæµ·å¸‚', 'åŸå¸‚': 'ä¸Šæµ·å¸‚', 'å­¦æ ¡': 'åä¸œç†å·¥å¤§å­¦', 'ç”µè¯': '13847783430'},
        { 'å§“å': 'ç‹æ˜­æ·‡', 'çœä»½': 'é™•è¥¿çœ', 'åŸå¸‚': 'è¥¿å®‰å¸‚', 'å­¦æ ¡': 'ç©ºå†›å·¥ç¨‹å¤§å­¦', 'ç”µè¯': '13310347790'},
        { 'å§“å': 'å¼ å­æ¶µ', 'çœä»½': 'ä¸Šæµ·å¸‚', 'åŸå¸‚': 'ä¸Šæµ·å¸‚', 'å­¦æ ¡': 'ä¸œåå¤§å­¦', 'ç”µè¯': '15548556691'},
        { 'å§“å': 'è´¾æ¢¦è¶', 'çœä»½': 'ä¸Šæµ·å¸‚', 'åŸå¸‚': 'ä¸Šæµ·å¸‚', 'å­¦æ ¡': 'åä¸œå¸ˆèŒƒå¤§å­¦', 'ç”µè¯': '18147754342'},
        { 'å§“å': 'å´æ²‚è½©', 'çœä»½': 'æ¹–åŒ—çœ', 'åŸå¸‚': 'æ­¦æ±‰å¸‚', 'å­¦æ ¡': 'æ­¦æ±‰ç†å·¥å¤§å­¦', 'ç”µè¯': '13029578588'},
        { 'å§“å': 'æœ±æ€¡ç’‡', 'çœä»½': 'å±±ä¸œçœ', 'åŸå¸‚': 'é’å²›å¸‚', 'å­¦æ ¡': 'åº·å¤å¤§å­¦', 'ç”µè¯': '18204916366'},
        { 'å§“å': 'é«˜ä¸€åš', 'çœä»½': 'åŒ—äº¬å¸‚', 'åŸå¸‚': 'åŒ—äº¬å¸‚', 'å­¦æ ¡': 'ä¸­å›½æ”¿æ³•å¤§å­¦', 'ç”µè¯': '19997771198'},
        { 'å§“å': 'é™ˆè¾°', 'çœä»½': 'åŒ—äº¬å¸‚', 'åŸå¸‚': 'åŒ—äº¬å¸‚', 'å­¦æ ¡': 'åŒ—äº¬é‚®ç”µå¤§å­¦', 'ç”µè¯': '15147727090'},
        { 'å§“å': 'ç‹æ˜è¾‰', 'çœä»½': 'åŒ—äº¬å¸‚', 'åŸå¸‚': 'åŒ—äº¬å¸‚', 'å­¦æ ¡': 'ä¸­å›½äººæ°‘å…¬å®‰å¤§å­¦', 'ç”µè¯': '19847317619'},
        { 'å§“å': 'èƒ¡å‡¯è¯µ', 'çœä»½': 'å‰æ—çœ', 'åŸå¸‚': 'é•¿æ˜¥å¸‚', 'å­¦æ ¡': 'å‰æ—å¤§å­¦', 'ç”µè¯': '15391277387'},
        { 'å§“å': 'èµµä¿å‡¯', 'çœä»½': 'ç”˜è‚ƒçœ', 'åŸå¸‚': 'å…°å·å¸‚', 'å­¦æ ¡': 'å…°å·å¤§å­¦', 'ç”µè¯': '13020445652'},
        { 'å§“å': 'æå›½ç’‹', 'çœä»½': 'åŒ—äº¬å¸‚', 'åŸå¸‚': 'åŒ—äº¬å¸‚', 'å­¦æ ¡': 'åŒ—äº¬å¤§å­¦åŒ»å­¦éƒ¨', 'ç”µè¯': '15149687831'},
        { 'å§“å': 'æ¨å®‡é“­', 'çœä»½': 'å±±ä¸œçœ', 'åŸå¸‚': 'å¨æµ·å¸‚', 'å­¦æ ¡': 'åŒ—äº¬äº¤é€šå¤§å­¦(å¨æµ·)', 'ç”µè¯': '13948174888'},
        { 'å§“å': 'çŸ³æ™ºä¸­', 'çœä»½': 'é™•è¥¿çœ', 'åŸå¸‚': 'è¥¿å®‰å¸‚', 'å­¦æ ¡': 'è¥¿å®‰ç”µå­ç§‘æŠ€å¤§å­¦', 'ç”µè¯': '18847789965'},
        { 'å§“å': 'æè‰¾é”¡', 'çœä»½': 'æ²³å—çœ', 'åŸå¸‚': 'éƒ‘å·å¸‚', 'å­¦æ ¡': 'éƒ‘å·å¤§å­¦', 'ç”µè¯': '18647736086'},
        { 'å§“å': 'å¼ é–å‘¨', 'çœä»½': 'å¹¿ä¸œçœ', 'åŸå¸‚': 'ç æµ·å¸‚', 'å­¦æ ¡': 'åŒ—å¸ˆé¦™æ¸¯æµ¸ä¼šå¤§å­¦', 'ç”µè¯': '13722081888'},
        { 'å§“å': 'åˆ˜æ”¿æº', 'çœä»½': 'æ¹–åŒ—çœ', 'åŸå¸‚': 'æ­¦æ±‰å¸‚', 'å­¦æ ¡': 'åä¸­å†œä¸šå¤§å­¦', 'ç”µè¯': '15714872203'},
        { 'å§“å': 'èµµç¿Šåš', 'çœä»½': 'å±±è¥¿çœ', 'åŸå¸‚': 'å¤ªåŸå¸‚', 'å­¦æ ¡': 'å¤ªåŸç†å·¥å¤§å­¦', 'ç”µè¯': '15149420947'},
        { 'å§“å': 'ä¸¥å“å†‰', 'çœä»½': 'æ²³åŒ—çœ', 'åŸå¸‚': 'ç§¦çš‡å²›å¸‚', 'å­¦æ ¡': 'ä¸œåŒ—å¤§å­¦(ç§¦çš‡å²›)', 'ç”µè¯': '15647757219'},
        { 'å§“å': 'å¼ æ™ºåº­', 'çœä»½': 'æ²³åŒ—çœ', 'åŸå¸‚': 'ä¿å®šå¸‚', 'å­¦æ ¡': 'ååŒ—ç”µåŠ›å¤§å­¦', 'ç”µè¯': '18847725450'},
        { 'å§“å': 'ç™½æ…§', 'çœä»½': 'å››å·çœ', 'åŸå¸‚': 'æˆéƒ½å¸‚', 'å­¦æ ¡': 'è¥¿å—è´¢ç»å¤§å­¦', 'ç”µè¯': '18847767514'},
        { 'å§“å': 'æ¸©èˆ’é¦¨', 'çœä»½': 'æ²³åŒ—çœ', 'åŸå¸‚': 'çŸ³å®¶åº„å¸‚', 'å­¦æ ¡': 'æ²³åŒ—åŒ»ç§‘å¤§å­¦', 'ç”µè¯': '19284776895'},
        { 'å§“å': 'ç‹æ¢“ç¡•', 'çœä»½': 'å†…è’™å¤è‡ªæ²»åŒº', 'åŸå¸‚': 'å‘¼å’Œæµ©ç‰¹å¸‚', 'å­¦æ ¡': 'å†…è’™å¤è­¦å¯Ÿå­¦é™¢', 'ç”µè¯': '15149721641'},
        { 'å§“å': 'é«˜æºç’', 'çœä»½': 'å†…è’™å¤è‡ªæ²»åŒº', 'åŸå¸‚': 'å‘¼å’Œæµ©ç‰¹å¸‚', 'å­¦æ ¡': 'å†…è’™å¤å¤§å­¦', 'ç”µè¯': '15354980212'},
        { 'å§“å': 'é™ˆå¢¨æ¶µ', 'çœä»½': 'è¾½å®çœ', 'åŸå¸‚': 'æ²ˆé˜³å¸‚', 'å­¦æ ¡': 'ä¸œåŒ—å¤§å­¦', 'ç”µè¯': '15849747477'},
        { 'å§“å': 'å®‰ç¾¿å', 'çœä»½': 'é™•è¥¿çœ', 'åŸå¸‚': 'è¥¿å®‰å¸‚', 'å­¦æ ¡': 'è¥¿åŒ—å¤§å­¦', 'ç”µè¯': '19997771401'},
             ];
    }

    // åˆå§‹åŒ–åº”ç”¨
    function init() {
      initEventListeners();
      // ä½¿ç”¨æ‰‹åŠ¨å½•å…¥æ•°æ®
      const studentData = manuallyEnterData();
      // å¤„ç†æ•°æ®
      processExcelData(studentData);
      // æ˜¾ç¤ºåœ°å›¾å’Œç»Ÿè®¡ä¿¡æ¯
      uploadPrompt.classList.add('hidden');
      statsCards.classList.remove('hidden');
      mapContainer.classList.remove('hidden');
      // åŠ è½½åœ°å›¾æ•°æ®
      loadMapData();
    }

    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    window.addEventListener('load', init);
  </script>
</body>
</html>